import{j as e}from"./jsx-runtime.Bq1fMrfD.js";import{r as t}from"./index.D6wfdm0j.js";const a=36e5;function n(e,t,a="",n=null){const r=new Date,i=r.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),o=r.getFullYear()+"å¹´"+(r.getMonth()+1)+"æœˆ"+r.getDate()+"æ—¥ æ˜ŸæœŸ"+["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][r.getDay()]+" "+i;if(!e||e.error)return{location:a||"æœªçŸ¥ä½ç½®",condition:e&&e.reason?e.reason:"è¯¥ä½ç½®æš‚ä¸æ”¯æŒ",temperature:"N/A",tempRange:"N/A",airQuality:"N/A",time:i,fullDateTime:o,icon:"ğŸŒ¤ï¸"};const l=e.current||{},c=l.weather_code||0,s=void 0!==l.temperature_2m?`${Math.round(l.temperature_2m)}Â°C`:"N/A";let u="N/A";if(e.daily){const t=e.daily.temperature_2m_min?.[0],a=e.daily.temperature_2m_max?.[0];void 0!==t&&void 0!==a&&(u=`${Math.round(t)}~${Math.round(a)}Â°C`)}let d="N/A";e.current&&void 0!==e.current.relative_humidity_2m&&(d=`${e.current.relative_humidity_2m}%`);let m="N/A";if(e.current&&void 0!==e.current.european_aqi){const t=e.current.european_aqi;let a="";a=t<=20?"ä¼˜":t<=40?"è‰¯":t<=60?"ä¸­ç­‰":t<=80?"ä¸€èˆ¬":t<=100?"å·®":"ä¸¥é‡",m=`${a} (${t})`}let p="æœªçŸ¥",h="ğŸŒ¤ï¸";return void 0!==c&&(0===c?(p="æ™´",h="â˜€ï¸"):1===c?(p="å¤§éƒ¨æ™´æœ—",h="â˜€ï¸"):2===c?(p="å±€éƒ¨å¤šäº‘",h="â›…"):3===c?(p="å¤šäº‘",h="â›…"):[45,48].includes(c)?(p="é›¾",h="ğŸŒ«ï¸"):[51,53,55,56,57].includes(c)?(p="å°é›¨",h="ğŸŒ¦ï¸"):[61,63,66,80,81].includes(c)?(p="ä¸­é›¨",h="ğŸŒ§ï¸"):[65,67,82].includes(c)?(p="å¤§é›¨",h="ğŸŒ§ï¸"):[95,96,99].includes(c)?(p="é›·é›¨",h="âš¡"):[71,73,75,77,85,86].includes(c)?(p="é›ª",h="â„ï¸"):(p="é˜´",h="â˜ï¸")),{location:a||"æœªçŸ¥ä½ç½®",condition:p,temperature:s,tempRange:u,airQuality:m,humidity:d,time:i,fullDateTime:o,icon:h}}function r(){const[r,i]=t.useState({location:"",condition:"",temperature:"",tempRange:"",airQuality:"",time:"",fullDateTime:"",icon:"ğŸŒ¤ï¸"}),[o,l]=t.useState(!0),[c,s]=t.useState(""),u=t.useRef({data:null,lastUpdated:0,location:"",coordinates:null}),d=t.useRef(!1),m=t.useRef(0),p=async()=>{if(d.current)return;const e=Date.now();if(!(e-m.current<5e3)){d.current=!0,m.current=e,l(!0);try{if(u.current.data&&e-u.current.lastUpdated<a)return i(u.current.data),l(!1),void(d.current=!1);const{location:r,coordinates:o}=await(async()=>{try{if(u.current.location&&u.current.coordinates)return{location:u.current.location,coordinates:u.current.coordinates};let n="",r=null;try{const e=new AbortController,t=setTimeout((()=>e.abort()),4e3),a=await fetch("https://api.myip.la/cn?json",{signal:e.signal,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36","Accept-Language":"zh-CN,zh;q=0.9"}});if(clearTimeout(t),a.ok){const e=await a.json();if(e&&e.location){e.location.latitude&&e.location.longitude&&(r={latitude:parseFloat(e.location.latitude),longitude:parseFloat(e.location.longitude)});const t=e.location.province||"",a=e.location.city||"";t&&a?n=a.includes(t.replace("çœ","").replace("å¸‚","").replace("éƒ½",""))?a:t+a:t?n=t:a?n=a:e.location.country_name&&(n=e.location.country_name)}}}catch(e){}if(!n)try{const a=await fetch("https://myip.ipip.net",{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36",Referer:"https://www.baidu.com/","Accept-Language":"zh-CN,zh;q=0.9","Keep-Alive":"yes","Cache-Control":"no-cache"}});if(a.ok){const i=await a.text();if(i&&i.includes("æ¥è‡ªäºï¼š")){const a=i.split("æ¥è‡ªäºï¼š")[1];if(a){const i=a.split("  ")[0];if(i){const a=i.trim().split(" ");n=a.length>=3?a[1]+a[2]:2===a.length?a[1]:a[0];try{r=await(async t=>{if(!t)return null;try{const e=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(t)}&format=json&limit=1&accept-language=zh-Hans&countrycodes=CN`,a=await fetch(e,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36","Accept-Language":"zh-CN,zh;q=0.9"}});if(!a.ok)throw new Error("åœ°ç†ç¼–ç è¯·æ±‚å¤±è´¥");const n=await a.json();if(n&&n.length>0){const{lat:e,lon:t}=n[0];return{latitude:parseFloat(e),longitude:parseFloat(t)}}if(t.length>2){const e=t.substring(0,2),a=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(e)}&format=json&limit=1&accept-language=zh-Hans&countrycodes=CN`,n=await fetch(a,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36","Accept-Language":"zh-CN,zh;q=0.9"}});if(n.ok){const e=await n.json();if(e&&e.length>0){const{lat:t,lon:a}=e[0];return{latitude:parseFloat(t),longitude:parseFloat(a)}}}}return null}catch(e){return null}})(n)}catch(t){}}}}}}catch(a){}return n?(u.current.location=n,u.current.coordinates=r,s(n),{location:n,coordinates:r}):{location:"",coordinates:null}}catch(e){return{location:"",coordinates:null}}})();if(!r){const e=n({error:!0,reason:"è¯¥ä½ç½®æš‚ä¸æ”¯æŒ"},0,"æœªçŸ¥ä½ç½®");return i(e),void l(!1)}if(!o){const e=n({error:!0,reason:"æ— æ³•è·å–è¯¥ä½ç½®çš„åæ ‡"},0,r);return i(e),void l(!1)}const c=`https://api.open-meteo.com/v1/forecast?latitude=${o.latitude}&longitude=${o.longitude}&current=temperature_2m,weather_code,relative_humidity_2m&daily=temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=1`,m=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${o.latitude}&longitude=${o.longitude}&current=european_aqi&timezone=auto`,p=new AbortController,h=setTimeout((()=>p.abort()),4e3),g=await fetch(c,{signal:p.signal,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36","Accept-Language":"zh-CN,zh;q=0.9"}});if(clearTimeout(h),!g.ok)throw new Error(`è·å–å¤©æ°”ä¿¡æ¯å¤±è´¥: ${g.status} ${g.statusText}`);const f=await g.json();let x={current:{european_aqi:null}};try{const e=new AbortController,t=setTimeout((()=>e.abort()),5e3),a=await fetch(m,{signal:e.signal,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36","Accept-Language":"zh-CN,zh;q=0.9"}});clearTimeout(t),a.ok&&(x=await a.json())}catch(t){}const y=n({...f,current:{...f.current,european_aqi:x.current?.european_aqi}},0,r,o);u.current.data=y,u.current.lastUpdated=e,i(y),l(!1)}catch(r){const e=n({error:!0,reason:r.message},Date.now(),u.current.location||"æœªçŸ¥ä½ç½®");i(e),l(!1)}finally{d.current=!1}}};return t.useEffect((()=>{let e=!0,t=null;return t=()=>{if(!e||"visible"!==document.visibilityState)return;const t=Date.now();(!u.current.data||t-u.current.lastUpdated>a)&&p()},e&&("requestIdleCallback"in window?window.requestIdleCallback((()=>{e&&p()})):setTimeout((()=>{e&&p()}),1e3)),document.addEventListener("visibilitychange",t,{passive:!0}),()=>{e=!1,t&&document.removeEventListener("visibilitychange",t)}}),[]),e.jsx("div",{className:"mb-6 p-4 bg-gray-50/80 dark:bg-gray-800/80 backdrop-blur-xl rounded-2xl border border-black/5 dark:border-white/10 shadow-[0_2px_8px_rgba(0,0,0,0.06)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.15)]",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("span",{className:"text-2xl mr-3",children:r.icon}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"å½“åœ°å¤©æ°”"}),o?e.jsxs("div",{className:"text-gray-600 dark:text-gray-300 flex items-end",children:["åŠ è½½ä¸­",e.jsx("span",{className:"inline-block ml-px font-bold animate-wave",children:"."}),e.jsx("span",{className:"inline-block ml-px font-bold animate-wave [animation-delay:0.1s]",children:"."}),e.jsx("span",{className:"inline-block ml-px font-bold animate-wave [animation-delay:0.2s]",children:"."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:`${r.location}: ${r.condition} ${r.temperature}`}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:`${r.tempRange} | ç©ºæ°”è´¨é‡: ${r.airQuality} | æ¹¿åº¦: ${r.humidity}`}),r.fullDateTime&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400","data-component-name":"WeatherIsland",children:`${r.fullDateTime}`})]})]})]})})}export{r as default};
